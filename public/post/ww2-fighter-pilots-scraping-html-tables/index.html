<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.55.4" />

  <title>World War II Flying Aces - Scraping a Wikipedia table (part 1) &middot; cod3x &amp; err@ta</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">#cod3x&err@ta</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/@mjfrigaard" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/mjfrigaard" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/mjfrigaard" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>World War II Flying Aces - Scraping a Wikipedia table (part 1)</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>03 May 2019</time>
  </div>

  

  
  
  
  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/wikipedia">wikipedia</a>
    
  </div>
  
  

</div>

  


<p>This post covers how to scrape a Wikipedia table of World War II (WWII) flying aces, store it in an R data frame, and export these data into a comma-separated values (.csv) file.</p>
<div id="the-data" class="section level1">
<h1>The data</h1>
<p>I want to download a table of World War II flying aces from <a href="https://en.wikipedia.org/wiki/List_of_World_War_II_flying_aces">Wikipedia.</a> To do this I will need functions from <code>xml2</code>, <code>rvest</code>, <code>dplyr</code>, <code>stringr</code>, <code>lubridate</code>, and <code>readr</code>.</p>
<pre class="r"><code>library(xml2)
library(rvest)
library(tidyverse)</code></pre>
<div id="download-html-page-into-object-in-r" class="section level2">
<h2>Download html page into object in R</h2>
<p>First I want to store the web <a href="https://en.wikipedia.org/wiki/URL">url</a> into a string vector in R.</p>
<pre class="r"><code>wiki_url &lt;- &quot;https://en.wikipedia.org/wiki/List_of_World_War_II_flying_aces&quot;</code></pre>
<p>Next I want to use the <code>xml2::read_html()</code> function to read the HTML from the webpage.</p>
<pre class="r"><code>wiki_page &lt;- xml2::read_html(&quot;https://en.wikipedia.org/wiki/List_of_World_War_II_flying_aces&quot;)</code></pre>
<blockquote>
<p><strong>Store and explore</strong>* refers to storing an output of a call to an object, then checking the contents of that new object. This is a great way to get to know R and how functions interact with different objects.</p>
</blockquote>
<pre class="r"><code>utils::str(wiki_page)</code></pre>
<pre><code>List of 2
 $ node:&lt;externalptr&gt; 
 $ doc :&lt;externalptr&gt; 
 - attr(*, &quot;class&quot;)= chr [1:2] &quot;xml_document&quot; &quot;xml_node&quot;</code></pre>
<pre class="r"><code>utils::head(wiki_page)</code></pre>
<pre><code>$node
&lt;pointer: 0x7ff521645aa0&gt;

$doc
&lt;pointer: 0x7ff5216460f0&gt;</code></pre>
<p>Ok–still not in a data frame (rectangle) I can use. I need to extract the <code>table</code> with <code>css</code> selector.</p>
</div>
<div id="extract-css-tables" class="section level2">
<h2>Extract <code>css</code> tables</h2>
<p><code>rvest</code> comes with a handy <code>html_nodes()</code> function we can tell to look for the <code>table</code>s.</p>
<pre class="r"><code>wiki_tables &lt;- wiki_page %&gt;% rvest::html_nodes(css = &quot;table&quot;)
# store and explore!
utils::str(wiki_tables)</code></pre>
<pre><code>List of 3
 $ :List of 2
  ..$ node:&lt;externalptr&gt; 
  ..$ doc :&lt;externalptr&gt; 
  ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
 $ :List of 2
  ..$ node:&lt;externalptr&gt; 
  ..$ doc :&lt;externalptr&gt; 
  ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
 $ :List of 2
  ..$ node:&lt;externalptr&gt; 
  ..$ doc :&lt;externalptr&gt; 
  ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
 - attr(*, &quot;class&quot;)= chr &quot;xml_nodeset&quot;</code></pre>
<pre class="r"><code>utils::head(wiki_tables)</code></pre>
<pre><code>{xml_nodeset (3)}
[1] &lt;table class=&quot;box-More_footnotes plainlinks metadata ambox ambox-sty ...
[2] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size: 9pt; text-align: ...
[3] &lt;table class=&quot;nowraplinks hlist collapsible autocollapse navbox-inne ...</code></pre>
<p>If we go back to the wikipedia page and look, the first column in the table we are looking for is named <code>Name</code> (for name of the pilot).</p>
<p>I can do a little base R subsetting and <code>base::grep()</code> to look for a table with <code>Name</code> in a column.</p>
<pre class="r"><code>relevant_tables &lt;- wiki_tables[base::grep(pattern = &quot;Name&quot;, x = wiki_tables)]
utils::str(relevant_tables)</code></pre>
<pre><code>List of 1
 $ :List of 2
  ..$ node:&lt;externalptr&gt; 
  ..$ doc :&lt;externalptr&gt; 
  ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
 - attr(*, &quot;class&quot;)= chr &quot;xml_nodeset&quot;</code></pre>
<pre class="r"><code>utils::head(relevant_tables)</code></pre>
<pre><code>{xml_nodeset (1)}
[1] &lt;table class=&quot;wikitable sortable&quot; style=&quot;font-size: 9pt; text-align: ...</code></pre>
<p>Great! Now I am down to one table. I can use the bracket subsetting again <code>[[]]</code> and <code>rvest::html_table()</code> to find this table and put it in a data frame.</p>
<pre class="r"><code>WW2AcesRAW &lt;- rvest::html_table(x = relevant_tables[[1]], fill = TRUE)
utils::str(WW2AcesRAW)</code></pre>
<pre><code>&#39;data.frame&#39;:   1708 obs. of  6 variables:
 $ Name                  : chr  &quot;Erich Hartmann&quot; &quot;Gerhard Barkhorn&quot; &quot;Günther Rall&quot; &quot;Otto Kittel †&quot; ...
 $ Country               : chr  &quot;Germany&quot; &quot;Germany&quot; &quot;Germany&quot; &quot;Germany&quot; ...
 $ Service(s)            : chr  &quot;Luftwaffe&quot; &quot;Luftwaffe&quot; &quot;Luftwaffe&quot; &quot;Luftwaffe&quot; ...
 $ Aerial Victories      : chr  &quot;352&quot; &quot;301&quot; &quot;275&quot; &quot;267&quot; ...
 $ Other Aerial Victories: chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
 $ Notes                 : chr  &quot;Top ace of all time. First ever with 300 victories, achieved coincident with Double-ace in a day&quot; &quot;&quot; &quot;&quot; &quot;Top Focke-Wulf 190 ace&quot; ...</code></pre>
<p>I’ll convert this data frame to a tibble for some fancier manipulation methods.</p>
<pre class="r"><code>WW2AcesRAW &lt;- as_tibble(WW2AcesRAW)</code></pre>
</div>
<div id="data-checks" class="section level2">
<h2>Data checks</h2>
<p>I want to check and make sure these data line up the same way they do in the table on the website.</p>
<pre class="r"><code>WW2AcesRAW %&gt;% utils::head(10)</code></pre>
<pre><code># A tibble: 10 x 6
   Name              Country `Service(s)` `Aerial Victories`
   &lt;chr&gt;             &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;             
 1 Erich Hartmann    Germany Luftwaffe    352               
 2 Gerhard Barkhorn  Germany Luftwaffe    301               
 3 Günther Rall      Germany Luftwaffe    275               
 4 Otto Kittel †     Germany Luftwaffe    267               
 5 Walter Nowotny †  Germany Luftwaffe    258               
 6 Wilhelm Batz      Germany Luftwaffe    237               
 7 Erich Rudorffer   Germany Luftwaffe    222               
 8 Heinz Bär         Germany Luftwaffe    220               
 9 Hermann Graf      Germany Luftwaffe    212               
10 Heinrich Ehrler † Germany Luftwaffe    208               
   `Other Aerial Victori… Notes                                            
   &lt;chr&gt;                  &lt;chr&gt;                                            
 1 &quot;&quot;                     Top ace of all time. First ever with 300 victori…
 2 &quot;&quot;                     &quot;&quot;                                               
 3 &quot;&quot;                     &quot;&quot;                                               
 4 &quot;&quot;                     Top Focke-Wulf 190 ace                           
 5 &quot;&quot;                     Double-ace in a day on two different occasions. …
 6 &quot;&quot;                     &quot;&quot;                                               
 7 &quot;&quot;                     Jet ace with 12 victories in Me 262, Double-ace …
 8 &quot;&quot;                     Jet ace with 16 victories in Me 262              
 9 &quot;&quot;                     First ever with 200 victories                    
10 &quot;&quot;                     Jet ace with 5 victories in Me 262               </code></pre>
<div class="figure">
<img src="/post/2019-05-03-ww2-fighter-pilots-scraping-html-tables_files/head_pilots.png" alt="Top of the table on wikipedia" style="width:80.0%" />
<p class="caption">Top of the table on wikipedia</p>
</div>
<pre class="r"><code>WW2AcesRAW %&gt;% utils::tail(10)</code></pre>
<pre><code># A tibble: 10 x 6
   Name               Country `Service(s)`             `Aerial Victories`
   &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt;                    &lt;chr&gt;             
 1 Constantin Nicoară Romania Royal Romanian Air Force 5                 
 2 Petre Cordescu     Romania Royal Romanian Air Force 5                 
 3 Aurel Tifrea       Romania Royal Romanian Air Force 5                 
 4 Hariton Dusescu    Romania Royal Romanian Air Force 5                 
 5 Vintilă Brătianu   Romania Royal Romanian Air Force 5                 
 6 Nicolae Burileanu  Romania Royal Romanian Air Force 5                 
 7 Laurențiu Catană   Romania Royal Romanian Air Force 5                 
 8 Erich Selei        Romania Royal Romanian Air Force 5                 
 9 Gheorghe Cristea   Romania Royal Romanian Air Force 5                 
10 Mircea Dumitrescu  Romania Royal Romanian Air Force 5                 
   `Other Aerial Victories` Notes
   &lt;chr&gt;                    &lt;chr&gt;
 1 &quot;&quot;                       &quot;&quot;   
 2 &quot;&quot;                       &quot;&quot;   
 3 &quot;&quot;                       &quot;&quot;   
 4 &quot;&quot;                       &quot;&quot;   
 5 &quot;&quot;                       &quot;&quot;   
 6 &quot;&quot;                       &quot;&quot;   
 7 &quot;&quot;                       &quot;&quot;   
 8 &quot;&quot;                       &quot;&quot;   
 9 &quot;&quot;                       &quot;&quot;   
10 &quot;&quot;                       &quot;&quot;   </code></pre>
<div class="figure">
<img src="/post/2019-05-03-ww2-fighter-pilots-scraping-html-tables_files/tail_pilots.png" alt="Bottom of the wikipedia table" style="width:80.0%" />
<p class="caption">Bottom of the wikipedia table</p>
</div>
<p>Great! Now I have a dataset with all the ace fighter pilots from WW2. I will export these data to a Github repository <a href="https://github.com/mjfrigaard/cloud-projects/tree/master/Data">here</a>. The other datasets and objects can be removed from the working environment.</p>
<p>I will export and these as a .csv with a time-stamp.</p>
<pre class="r"><code># create time stamp
readr::write_csv(x = WW2AcesRAW, 
                 path = 
                  paste0(base::noquote(lubridate::today()),
                         &quot;-WW2AcesRAW&quot;,
                         &quot;.csv&quot;))
# check
# fs::dir_ls(&quot;data&quot;)</code></pre>
<p>Great! Next post I will visualize these data.</p>
</div>
</div>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/exploring-ww2-figher-pilots/">World War II Flying Aces - Exploratory data analysis packages/techniques (part 2)</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/exploring-ww2-figher-pilots/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'Your Disqus shortname';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="/js/ui.js"></script>
<script src="/js/menus.js"></script>


<script>
  
  if (window.location.hostname != "localhost") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'Your Google Analytics tracking ID', 'auto');
    ga('send', 'pageview');
  }
</script>





</body>
</html>

